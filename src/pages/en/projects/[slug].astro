---
import MainLayout from '../../../layouts/MainLayout.astro';
import fs from 'node:fs';
import path from 'node:path';
import matter from 'gray-matter';

export async function getStaticPaths() {
  const lang = "en";
  const projectsDir = `./src/content/projects/${lang}`;
  
  if (!fs.existsSync(projectsDir)) return [];

  const folders = fs.readdirSync(projectsDir).filter(f => 
    fs.statSync(path.join(projectsDir, f)).isDirectory()
  );

  return folders.map(folder => ({
    params: { slug: folder },
    props: { lang }
  }));
}

const { slug } = Astro.params;
const { lang } = Astro.props;
const projectPath = path.join(`./src/content/projects/${lang}`, slug);

// –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª—ã –∏ –±–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ (data)
// 1. –ß–∏—Ç–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤
const files = fs.readdirSync(projectPath).filter(f => f.endsWith('.md'));

// 2. –°–Ω–∞—á–∞–ª–∞ –º–∞–ø–ø–∏–º –¥–∞–Ω–Ω—ã–µ, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ frontmatter (order)
const cards = files.map(file => {
  const filePath = path.join(projectPath, file);
  const fileContent = fs.readFileSync(filePath, 'utf-8');
  const { data } = matter(fileContent);
  return { 
    id: file.replace('.md', ''), 
    data 
  };
})
// 3. –¢–ï–ü–ï–†–¨ –°–û–†–¢–ò–†–£–ï–ú –ø–æ –ø–æ–ª—é order
// –ï—Å–ª–∏ order –Ω–µ —É–∫–∞–∑–∞–Ω, —Å—Ç–∞–≤–∏–º 99 (—É–ª–µ—Ç–∏—Ç –≤ –∫–æ–Ω–µ—Ü)
.sort((a, b) => (a.data.order || 99) - (b.data.order || 99));
---

<MainLayout title={`Project: ${slug}`}>
  <header class="project-header">
    <div class="header-content">
      <span class="folder-badge">üìÅ Project</span>
      <h1>{slug.replace(/-/g, ' ')}</h1>
      <p>Select a stage to explore</p>
    </div>
  </header>

  <div class="articles-grid">
    {cards.map(card => (
      /* URL FIX: Added /en/ prefix for internal navigation */
      <a href={`/${lang}/projects/${slug}/${card.id}`} class="step-card">
        <div class="card-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>
        </div>
        <div class="card-info">
          <h2>{card.data.title}</h2>
          <p>{card.data.description || "Click to read more details..."}</p>
        </div>
        <div class="card-arrow">‚Üí</div>
      </a>
    ))}
  </div>
</MainLayout>

<style>
  /* –®–∞–ø–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ */
  .project-header {
    margin: 40px 0;
    padding-bottom: 20px;
    border-bottom: 1px solid #222;
  }
  .folder-badge {
    color: var(--accent);
    font-weight: bold;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 1px;
  }
  .project-header h1 { 
    margin: 10px 0; 
    font-size: 2.5rem; 
    text-transform: capitalize; 
    color: #fff;
  }
  .project-header p { color: #666; }

  /* –°–ï–¢–ö–ê (GRID) */
  .articles-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 20px;
    margin-bottom: 50px;
  }

  /* –°–¢–ò–õ–¨ –ö–ê–†–¢–û–ß–ö–ò */
  .step-card {
    background: #161616;
    border: 1px solid #222;
    padding: 24px;
    border-radius: 12px;
    display: flex;
    align-items: flex-start;
    gap: 20px;
    text-decoration: none;
    transition: all 0.2s ease-in-out;
    position: relative;
    overflow: hidden;
  }

  .step-card:hover {
    background: #1c1c1c;
    border-color: var(--accent);
    transform: translateY(-4px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
  }

  .card-icon {
    color: var(--accent);
    background: rgba(var(--accent-rgb), 0.1);
    padding: 10px;
    border-radius: 8px;
    display: flex;
  }

  .card-info h2 {
    margin: 0 0 8px 0;
    font-size: 1.2rem;
    color: #fff;
    transition: color 0.2s;
  }

  .step-card:hover .card-info h2 {
    color: var(--accent);
  }

  .card-info p {
    margin: 0;
    color: #888;
    font-size: 0.9rem;
    line-height: 1.5;
  }

  .card-arrow {
    position: absolute;
    right: 20px;
    bottom: 20px;
    color: #333;
    font-size: 1.2rem;
    transition: 0.2s;
  }

  .step-card:hover .card-arrow {
    color: var(--accent);
    transform: translateX(5px);
  }

  @media (max-width: 600px) {
    .articles-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
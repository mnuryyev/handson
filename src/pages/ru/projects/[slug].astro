---
import MainLayout from '../../../layouts/MainLayout.astro'; // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø—É—Ç—å (3 —É—Ä–æ–≤–Ω—è –≤–≤–µ—Ä—Ö)
import fs from 'node:fs';
import path from 'node:path';
import matter from 'gray-matter';

export async function getStaticPaths() {
  const lang = "ru";
  const projectsDir = `./src/content/projects/${lang}`;
  
  if (!fs.existsSync(projectsDir)) return [];

  const folders = fs.readdirSync(projectsDir).filter(f => 
    fs.statSync(path.join(projectsDir, f)).isDirectory()
  );

  return folders.map(folder => ({
    params: { slug: folder },
    props: { lang }
  }));
}

const { slug } = Astro.params;
const { lang } = Astro.props;
const projectPath = path.join(`./src/content/projects/${lang}`, slug);

// –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª—ã –∏ –±–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ (data)
const files = fs.readdirSync(projectPath).filter(f => f.endsWith('.md')).sort();

const cards = files.map(file => {
  const filePath = path.join(projectPath, file);
  const fileContent = fs.readFileSync(filePath, 'utf-8');
  const { data } = matter(fileContent);
  return { 
    id: file.replace('.md', ''), 
    data 
  };
});
---

<MainLayout title={`–ü—Ä–æ–µ–∫—Ç: ${slug}`}>
  <header class="project-header">
    <div class="header-content">
      <span class="folder-badge">üìÅ –ü—Ä–æ–µ–∫—Ç</span>
      <h1>{slug.replace(/-/g, ' ')}</h1>
      <p>–í—ã–±–µ—Ä–∏—Ç–µ —ç—Ç–∞–ø –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è</p>
    </div>
  </header>

  <div class="articles-grid">
    {cards.map(card => (
      /* –ò–°–ü–†–ê–í–õ–ï–ù URL: –¥–æ–±–∞–≤–ª–µ–Ω /ru/ –ø—Ä–µ—Ñ–∏–∫—Å */
      <a href={`/${lang}/projects/${slug}/${card.id}`} class="step-card">
        <div class="card-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>
        </div>
        <div class="card-info">
          <h2>{card.data.title}</h2>
          <p>{card.data.description || "–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –ø—Ä–æ—á–∏—Ç–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ..."}</p>
        </div>
        <div class="card-arrow">‚Üí</div>
      </a>
    ))}
  </div>
</MainLayout>

<style>
  /* –°—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, –æ–Ω–∏ –æ—Ç–ª–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç */
  .project-header {
    margin: 40px 0;
    padding-bottom: 20px;
    border-bottom: 1px solid #222;
  }
  .folder-badge {
    color: var(--accent);
    font-weight: bold;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 1px;
  }
  .project-header h1 { 
    margin: 10px 0; 
    font-size: 2.5rem; 
    text-transform: capitalize; 
  }
  .project-header p { color: #666; }

  .articles-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 20px;
    margin-bottom: 50px;
  }

  .step-card {
    background: #161616;
    border: 1px solid #222;
    padding: 24px;
    border-radius: 12px;
    display: flex;
    align-items: flex-start;
    gap: 20px;
    text-decoration: none;
    transition: all 0.2s ease-in-out;
    position: relative;
    overflow: hidden;
  }

  .step-card:hover {
    background: #1c1c1c;
    border-color: var(--accent);
    transform: translateY(-4px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
  }

  .card-icon {
    color: var(--accent);
    background: rgba(var(--accent-rgb), 0.1);
    padding: 10px;
    border-radius: 8px;
    display: flex;
  }

  .card-info h2 {
    margin: 0 0 8px 0;
    font-size: 1.2rem;
    color: #fff;
    transition: color 0.2s;
  }

  .step-card:hover .card-info h2 {
    color: var(--accent);
  }

  .card-info p {
    margin: 0;
    color: #888;
    font-size: 0.9rem;
    line-height: 1.5;
  }

  .card-arrow {
    position: absolute;
    right: 20px;
    bottom: 20px;
    color: #333;
    font-size: 1.2rem;
    transition: 0.2s;
  }

  @media (max-width: 600px) {
    .articles-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
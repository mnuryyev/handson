---
import MainLayout from '../../../layouts/MainLayout.astro';
import LabCard from '../../../components/LabCard.astro'; 
import fs from 'node:fs';
import path from 'node:path';
import matter from 'gray-matter';

// –ü–æ–ª—É—á–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (/handson/)
const base = import.meta.env.BASE_URL;

export async function getStaticPaths({ paginate }) {
  // –í–ù–ò–ú–ê–ù–ò–ï: –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ –º–µ–Ω—è–π –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ (labs, writeups –∏–ª–∏ tools)
  const contentDir = './src/content/labs/ru'; 
  
  const files = fs.existsSync(contentDir) 
    ? fs.readdirSync(contentDir).filter(f => f.endsWith('.md'))
    : [];

  const allItems = files.map(file => {
    const fileContent = fs.readFileSync(path.join(contentDir, file), 'utf-8');
    const { data } = matter(fileContent);
    return {
      slug: file.replace('.md', ''),
      ...data
    };
  }).sort((a, b) => new Date(b.date || 0).getTime() - new Date(a.date || 0).getTime());

  return paginate(allItems, { pageSize: 12 });
}

const { page } = Astro.props;
const lang = "ru"; 
---

<MainLayout title={`–†–∞–∑–¥–µ–ª - –°—Ç—Ä–∞–Ω–∏—Ü–∞ ${page.currentPage}`}>
  <div class="container">
    <header class="page-header">
      <h1>üîê –†–∞–∑–¥–µ–ª</h1>
      <p>–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞</p>
    </header>

    <div class="grid">
      {page.data.map(item => (
        <LabCard 
          title={item.title} 
          desc={item.description} 
          date={item.date} 
          /* –£–±–∏—Ä–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π —Å–ª–µ—à, —á—Ç–æ–±—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–∞–º –¥–æ–±–∞–≤–∏–ª base */
          url={`${lang}/labs/${item.slug}`} 
          image={item.image}
        />
      ))}
    </div>

    <nav class="pagination">
      {page.url.prev ? (
        <a href={`${base}${page.url.prev.replace(/^\//, '')}`} class="p-btn">‚Üê –ù–∞–∑–∞–¥</a>
      ) : (
        <span class="p-btn disabled">‚Üê –ù–∞–∑–∞–¥</span>
      )}
      
      <div class="pages">{page.currentPage} / {page.lastPage}</div>
      
      {page.url.next ? (
        <a href={`${base}${page.url.next.replace(/^\//, '')}`} class="p-btn">–í–ø–µ—Ä–µ–¥ ‚Üí</a>
      ) : (
        <span class="p-btn disabled">–í–ø–µ—Ä–µ–¥ ‚Üí</span>
      )}
    </nav>
  </div>
</MainLayout>

<style>
  .container { max-width: 1200px; margin: 60px auto; padding: 0 20px; }
  .page-header { margin-bottom: 50px; border-bottom: 1px solid #222; padding-bottom: 30px; }
  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 40px 25px;
  }
  .pagination { margin-top: 60px; display: flex; justify-content: center; align-items: center; gap: 20px; }
  .p-btn { padding: 8px 16px; background: #111; border: 1px solid #333; border-radius: 6px; text-decoration: none; color: #fff; }
  .p-btn.disabled { opacity: 0.3; }
  .pages { color: #666; font-size: 0.9rem; }
</style>

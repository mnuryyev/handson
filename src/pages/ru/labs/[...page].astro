---
import MainLayout from '../../../layouts/MainLayout.astro';
import LabCard from '../../../components/LabCard.astro';
import fs from 'node:fs';
import path from 'node:path';
import matter from 'gray-matter';

// –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ –±–∞–∑–æ–≤–æ–≥–æ –ø—É—Ç–∏
const base = import.meta.env.BASE_URL;

export async function getStaticPaths({ paginate }) {
  const labsDir = './src/content/labs/ru';     
  
  if (!fs.existsSync(labsDir)) return [];

  const files = fs.readdirSync(labsDir).filter(f => f.endsWith('.md'));

  const allLabs = files.map(file => {
    const fileContent = fs.readFileSync(path.join(labsDir, file), 'utf-8');
    const { data } = matter(fileContent);
    
    return {
      slug: file.replace('.md', ''),
      ...data 
    };
  }).sort((a, b) => {
    const dateA = new Date(a.date || 0).getTime();
    const dateB = new Date(b.date || 0).getTime();
    return dateB - dateA; 
  });

  return paginate(allLabs, { pageSize: 12 });
}

const { page } = Astro.props;
const lang = "ru"; 
---

<MainLayout title={`–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã–µ - –°—Ç—Ä–∞–Ω–∏—Ü–∞ ${page.currentPage}`}>
  <div class="container">
    <header class="page-header">
      <h1>üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h1>
      <p>–†–∞–∑–±–æ—Ä—ã –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–º–µ—Ç–∫–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –∑–∞—â–∏—Ç–µ —Å–∏—Å—Ç–µ–º</p>
    </header>

    <div class="grid">
      {page.data.map(lab => (
        <LabCard 
          title={lab.title} 
          desc={lab.description} 
          date={lab.date} 
          /* –ò–°–ü–†–ê–í–õ–ï–ù–û: —É–±—Ä–∞–ª–∏ –Ω–∞—á–∞–ª—å–Ω—ã–π —Å–ª–µ—à, —á—Ç–æ–±—ã LabCard –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–æ–±–∞–≤–∏–ª base */
          url={`${lang}/labs/${lab.slug}`} 
          image={lab.image}
        />
      ))}
    </div>

    <nav class="pagination">
      {page.url.prev ? (
        /* –ò–°–ü–†–ê–í–õ–ï–ù–û: –¥–æ–±–∞–≤–∏–ª–∏ base –∏ —É–±—Ä–∞–ª–∏ –ª–∏—à–Ω–∏–π —Å–ª–µ—à */
        <a href={`${base}${page.url.prev.replace(/^\//, '')}`} class="p-btn">‚Üê –ù–∞–∑–∞–¥</a>
      ) : (
        <span class="p-btn disabled">‚Üê –ù–∞–∑–∞–¥</span>
      )}

      <div class="pages">
          {page.currentPage} / {page.lastPage}
      </div>

      {page.url.next ? (
        /* –ò–°–ü–†–ê–í–õ–ï–ù–û: –¥–æ–±–∞–≤–∏–ª–∏ base –∏ —É–±—Ä–∞–ª–∏ –ª–∏—à–Ω–∏–π —Å–ª–µ—à */
        <a href={`${base}${page.url.next.replace(/^\//, '')}`} class="p-btn">–í–ø–µ—Ä–µ–¥ ‚Üí</a>
      ) : (
        <span class="p-btn disabled">–í–ø–µ—Ä–µ–¥ ‚Üí</span>
      )}
    </nav>
  </div>
</MainLayout>

<style>
  .container { 
    max-width: 1200px; 
    margin: 60px auto; 
    padding: 0 20px; 
  }
  
  .page-header { 
    margin-bottom: 50px; 
    border-bottom: 1px solid #222; 
    padding-bottom: 30px; 
  }
  
  .page-header h1 {
    font-size: 2.5rem;
    margin-bottom: 10px;
  }

  .page-header p {
    color: #fffdfd;
    font-size: 1.1rem;
  }

  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 40px 25px;
  }

  .pagination { 
    margin-top: 60px; 
    display: flex; 
    justify-content: center; 
    align-items: center; 
    gap: 20px; 
  }

  .p-btn { 
    padding: 10px 20px; 
    background: #111; 
    border: 1px solid #333; 
    border-radius: 8px; 
    text-decoration: none; 
    color: #fff; 
    font-size: 0.9rem;
    transition: all 0.2s ease;
  }

  .p-btn:hover:not(.disabled) { 
    background: #1a1a1a; 
    border-color: var(--accent); 
  }

  .p-btn.disabled { 
    opacity: 0.2; 
    cursor: not-allowed; 
  }

  .pages { 
    color: #666; 
    font-size: 0.95rem; 
    font-weight: 600; 
    font-family: monospace;
  }
</style>

---
title: "Уязвимость протокола ARP и реализация MITM-атаки"
description: "В этой работе мы разберём, как работает ARP: от обмена запросами и анализа трафика в Wireshark до практической реализации MITM-атаки с перехватом данных"
image: "/images/arp_spoofing_sec/main.jpg"
date: "12 февраля 2026"
---
**ARP Spoofing** — это атака типа **Man-in-the-Middle**, основанная на особенностях работы протокола ARP, в котором отсутствуют механизмы проверки подлинности. Суть атаки заключается в том, что злоумышленник рассылает поддельные ARP-ответы и тем самым подменяет соответствие между IP- и MAC-адресами в локальной сети. В результате целевое устройство начинает считать атакующую машину, например, своим шлюзом по умолчанию, из-за чего весь сетевой трафик проходит через компьютер атакующего. Это даёт возможность перехватывать, анализировать и при необходимости изменять передаваемые данные.

В рамках данной работы мы рассмотрим данную уязвимость как с теоретической, так и с практической точки зрения. Мы развернём изолированную лабораторную среду на базе **Kali Linux** и **Windows 10**, в которой поэтапно воспроизведём атаку **ARP Spoofing**. В ходе эксперимента мы продемонстрируем перехват незашифрованного HTTP-трафика с использованием **Wireshark**.

## Фаза 1. Разведка и фиксация базового состояния сети

Перед началом атаки необходимо провести разведку сети и зафиксировать её исходное состояние. Это позволяет точно определить параметры целевых узлов и в дальнейшем наглядно показать, какие изменения произошли в результате ARP Spoofing. В первую очередь нас интересуют IP-адреса участников взаимодействия и текущее состояние ARP-таблиц, так как именно они будут изменены в ходе атаки.

### Шаг 1. Определение параметров целевых узлов

Для проведения эксперимента мы развернули виртуальную лабораторную среду, в которой в роли жертвы используется операционная система Windows 10, а в роли атакующей стороны Kali Linux. Обе виртуальные машины подключены в режиме Bridge, что позволяет им находиться в одном широковещательном домене и напрямую взаимодействовать друг с другом и с маршрутизатором. Примерная топология выглядит так:

![01_topology](/images/arp_spoofing_sec/01_topology.png)

Сначала на стороне жертвы была выполнена проверка сетевых настроек, чтобы определить IP-адрес системы и адрес основного шлюза. Эти данные необходимы для дальнейшего проведения MITM-атаки, так как весь внешний трафик Windows-машины проходит именно через шлюз. В ходе проверки было установлено, что IP-адрес жертвы *192.168.70.11*, а шлюз по умолчанию *192.168.70.1*.

![02_ipconfig](/images/arp_spoofing_sec/02_ipconfig.png)

### Шаг 2. Анализ исходной ARP-таблицы

После этого была зафиксирована исходная ARP-таблица на стороне Windows. Данный этап необходим для того, чтобы сохранить корректное состояние системы до начала атаки и иметь возможность сравнить его с результатами после отравления ARP-кэша. С помощью команды **arp -a** было получено текущее соответствие между IP-адресом шлюза и его MAC-адресом:

![03_arp_a_win](/images/arp_spoofing_sec/03_arp_a_win.png)

Из вывода видим, что шлюз по умолчанию связан с корректным MAC-адресом маршрутизатора, а тип записи обозначен как динамический. Это означает, что запись была получена автоматически и может быть изменена при получении новых ARP-ответов, что создаёт условия для проведения ARP Spoofing. Зафиксированная ARP-таблица используется в дальнейшем как контрольная точка.

### Шаг 3. Проверка сетевого интерфейса на стороне атакующего

![04_kali_ip_a](/images/arp_spoofing_sec/04_kali_ip_a.png)

На Kali открываем терминал и вводим команду ip a. В выводе видно, что активным сетевым интерфейсом является eth0, а IP-адрес системы *192.168.70.12*. Это означает, что Kali находится в одной сети с жертвой.

### Шаг 4. Проверка доступности цели

На Kali Linux проверяем доступность целевой машины. В терминале выполняем команду ping, указав IP-адрес Windows-системы *192.168.70.11*.

![05_ping_from_kali](/images/arp_spoofing_sec/05_ping_from_kali.png)

По результатам видим, что ответы от целевого узла приходят без потерь, а задержка минимальна. Это подтверждает стабильное сетевое соединение между атакующей машиной и жертвой и позволяет переходить к следующим этапам исследования.

### Шаг 5. Сканирование сети

Для получения общей картины сети используем утилиту netdiscover. В Kali Linux она, как правило, уже установлена по умолчанию либо появляется после обновления системы и стандартного апгрейда пакетов. Если утилиты нет, устанавливаем её через менеджер пакетов (**sudo apt install netdiscover -y**).

Далее запускаем сканирование локальной сети. Указываем используемый сетевой интерфейс (eth0) и диапазон сети *192.168.70.0/24*. Сканирование позволяет определить активные устройства в сегменте и получить их IP- и MAC-адреса.

![06_netdiscover_start](/images/arp_spoofing_sec/06_netdiscover_start.png)

![07_scan_finish](/images/arp_spoofing_sec/07_scan_finish.png)


Через несколько секунд в выводе появляется список обнаруженных узлов. В нём находим:

- IP-адрес и MAC-адрес маршрутизатора;
- IP-адрес и MAC-адрес Windows-машины.

После получения необходимой информации останавливаем сканирование сочетанием клавиш **Ctrl + C**.

Такой этап используется для реалистичного моделирования атаки, так как в реальных условиях перед проведением ARP Spoofing сначала выполняется картирование сети и определение всех потенциальных целей.

* * *

## Фаза 2. Настройка атакующей машины

### Шаг 6. Включение IP Forwarding

По умолчанию операционные системы семейства Linux отбрасывают пакеты, адресованные не им. Если мы запустим атаку в таком состоянии, Windows-машина потеряет связь с роутером и доступ в интернет будет прерван, что мгновенно демаскирует наше вмешательство.

Чтобы остаться незамеченным, мы должны заставить Kali Linux работать в режиме маршрутизатора, то есть принимать чужой трафик и тут же пересылать его по назначению. Для этого в ядре Linux активируется функция **IP Forwarding**.

Выполняем проверку и активацию через системную переменную net.ipv4.ip_forward:

![08_forwarding](/images/arp_spoofing_sec/08_forwarding.png)

### Шаг 7. Установка dsniff

Для реализации атаки нам необходимы специфические утилиты, способные формировать и отправлять в сеть произвольные ARP-пакеты. В среде Kali для этих целей есть пакет **dsniff**.

Главный компонент, который нас интересует в этом наборе, это утилита **arpspoof**. Её задача заключается в автоматизации процесса отправки поддельных ARP-ответов. Вместо того чтобы вручную формировать каждый кадр, мы делегируем это программе, а она будет с заданной периодичностью транслировать цели наш MAC-адрес, поддерживая подменённые записи в ARP-таблице. Проверка установки:

![09_dsniff](/images/arp_spoofing_sec/09_dsniff.png)

ARP‑кэш не статичен и со временем обновляется, т.е роутер периодически напоминает о своём настоящем MAC‑адресе. arpspoof решает эту проблему тем, что постоянно рассылает поддельные ARP‑ответы и не даёт этим записям восстановиться, удерживая трафик под нашим контролем.

* * *

## Фаза 3. Запуск атаки

После завершения подготовки мы переходим к активной фазе, установке контроля над каналом связи между жертвой и шлюзом. Чтобы реализовать полноценную MITM-атаку, нам необходимо организовать перехват данных в обоих направлениях. Для этого мы будем использовать два параллельных процесса **arpspoof**.

### Шаг 8. Запуск двустороннего ARP Spoofing

Открываем в Kali Linux два окна терминала и располагаем их рядом. Это позволяет одновременно контролировать процесс ARP‑подмены как со стороны жертвы, так и со стороны маршрутизатора.

![10_attackingpng](/images/arp_spoofing_sec/10_attackingpng.png)

**Терминал 1**. Запускаем атаку на Windows-машину. Мы указываем сетевой интерфейс (eth0), IP-адрес жертвы (192.168.70.11) и адрес шлюза (192.168.70.1), от имени которого будем выступать.

После запуска утилита начинает транслировать поддельные ARP-ответы. Фактически мы подменяем ARP‑соответствие на стороне жертвы, связывая IP‑адрес маршрутизатора с MAC‑адресом Kali Linux. Windows принимает полученные ARP‑ответы и обновляет свой ARP‑кэш, после чего весь исходящий трафик начинает направляться через атакующую машину.

**Терминал 2**. Обман маршрутизатора. Чтобы перехватывать не только исходящие, но и входящие пакеты из внешней сети, мы настраиваем аналогичный процесс во втором терминале, но целью выбираем уже сам роутер.

В этой команде мы сообщаем маршрутизатору, что MAC-адрес Windows-машины теперь соответствует нашему интерфейсу. Таким образом, мы замыкаем цикл, т.е роутер отправляет ответы из интернета нам, а мы, благодаря включённому ранее **IP Forwarding**, прозрачно пробрасываем их реальному получателю.

Наличие непрерывного потока ARP-ответов в обоих терминалах подтверждает, что атака активна. Теперь мы занимаем позицию человека посередине (Man-in-the-Middle) и готовы к анализу проходящего через нас трафика.

* * *

## Фаза 4: Подтверждение атаки и и анализ данных

После запуска активной фазы нам необходимо убедиться, что подмена адресов действительно произошла и целевая система приняла наши поддельные данные.

### Шаг 9. Проверка изменений в ARP-таблице жертвы

Для верификации результата мы переключаемся на Windows-машину. В командной строке повторно вводим команду **arp -a**, чтобы просмотреть текущее состояние ARP-кэша после начала атаки.

![11_arp_a_win](/images/arp_spoofing_sec/11_arp_a_win.png)

При анализе вывода мы фиксируем критический момент: IP-адрес роутера (192.168.70.1) и IP-адрес нашей атакующей машины Kali (192.168.70.12) теперь имеют абсолютно **одинаковый физический адрес**.

Сравнение состояний:

- До атаки: Шлюз был связан с реальным MAC-адресом маршрутизатора (90-f6-52-a9-e3-ac).
- После атаки: Шлюз привязан к MAC-адресу нашей системы (00-0c-29-07-84-66).

Windows-система больше не видит реальный роутер напрямую, для неё все пакеты, уходящие во внешнюю сеть, теперь должны отправляться на наш MAC-адрес.

### Шаг 10. Настройка фильтрации и генерация трафика

Проверяем, что трафик идёт через нашу систему, и сразу настраиваем фильтры Wireshark, чтобы видеть только нужные пакеты.

В верхней части окна Wireshark, в поле Filter, мы задаём параметры отображения. Нам нужно видеть только HTTP-запросы, исходящие от нашей жертвы или направленные ей. Вводим следующую конструкцию: **ip.addr == 192.168.70.11 && http**

![12_wireshark_kali](/images/arp_spoofing_sec/12_wireshark_kali.png)

Для проверки перехвата мы переходим на сторону Windows-машины и открываем любой браузер. Большинство современных сайтов используют HTTPS, из‑за чего содержимое пакетов зашифровано и недоступно для просмотра. Чтобы увидеть HTTP‑трафик в открытом виде, используем сайт http://neverssl.com, который работает без шифрования.

![13_neverssl](/images/arp_spoofing_sec/13_neverssl.png)

### Шаг 11. Анализ перехваченных данных

После того как жертва перешла на сайт, в окне Wireshark на Kali Linux отобразился список перехваченных HTTP-пакетов. Теперь мы можем детально изучить содержимое любого из них, чтобы понять, какую информацию может получить атакующий.

![14_wireshark_http](/images/arp_spoofing_sec/14_wireshark_http.png)

![15_analyzing](/images/arp_spoofing_sec/15_analyzing.png)

Для анализа выбираем любой пакет с методом **GET / HTTP/1.1**. В нижней части окна Wireshark раскрываем раздел Hypertext Transfer Protocol и смотрим содержимое прикладного уровня. Именно эти данные в нормальной ситуации должны быть видны только клиенту и веб‑серверу.

В результате анализа можем увидеть следующую информацию:

- Host - определяется целевой ресурс, в данном случае neverssl.com.
- User-Agent - отображается информация о системе жертвы, включая версию операционной системы (Windows 10) и используемый браузер.
- HTTP‑заголовки - доступны сведения о языке системы, параметрах кэширования и типах контента, которые принимает браузер.

Поскольку трафик передаётся без шифрования, все эти данные отображаются в открытом виде. В реальном сценарии на их месте могли находиться сессионные cookies, позволяющие получить доступ к учётной записи без ввода пароля, либо сами логины и пароли при работе с HTTP‑формами авторизации. Атака ARP Spoofing даёт полный контроль над незашифрованным сетевым трафиком и представляет серьёзную угрозу безопасности.

### Шаг 12. Демонстрация перехвата учётных данных

Для того чтобы оценить реальные риски атаки, мы проведем эксперимент по перехвату вводимых пользователем данных. В современных условиях большинство сайтов используют шифрование, поэтому для чистоты эксперимента мы создадим локальную тестовую форму, имитирующую страницу авторизации.

![16_test_html](/images/arp_spoofing_sec/16_test_html.png)

На стороне Windows мы создаем простой HTML-файл с формой ввода. Главная особенность этой формы использование метода **POST** и отправка данных по незащищённому протоколу HTTP на тестовый сервис httpbin.org.

### Шаг 13. фильтр в Wireshark

на Kali, мы изменим фильтр в Wireshark на **http.request.method == "POST"**, чтобы быстро найти пакет с данными формы.

![17_start_wireshark](/images/arp_spoofing_sec/17_start_wireshark.png)

### Шаг 14. Отправка тестовых учётных данных

На стороне Windows мы заполняем созданную форму. В поле логина ввели *testuser*, а в поле пароля *test123*. После нажатия кнопки *Login* данные были отправлены в сеть.

![18_test_win](/images/arp_spoofing_sec/18_test_win.png)

### Шаг 15. Анализ POST-запроса в Wireshark

Мы вернулись на Kali Linux и среди перехваченного трафика нашли пакет, отправленный методом **POST**. В отличие от обычного GET-запроса, этот пакет содержит тело сообщения, в котором и передаются введённые пользователем данные.

![19_wireshark_result](/images/arp_spoofing_sec/19_wireshark_result.png)

Кликнув на пакет и раскрыв секцию **HTML Form URL Encoded**, мы получили полный доступ к содержимому формы.

* * *

## Фаза 5. Остановка атаки и восстановление сети

### Шаг 16. Восстановление легитимных ARP‑записей

В первую очередь останавливаем работу arpspoof в обоих терминалах Kali Linux, используя сочетание клавиш Ctrl + C.

Это важно, потому что при корректной остановке утилита автоматически отправляет так называемые re-arping ARP‑пакеты. Жертве передаётся реальный MAC‑адрес маршрутизатора, а маршрутизатору реальный MAC‑адрес Windows‑машины.

### Шаг 17. Отключение IP Forwarding

После того как сетевые таблицы восстановились, нам нужно вернуть нашу систему в стандартное состояние. Мы отключаем функцию пересылки пакетов, чтобы Kali снова перестала работать как маршрутизатор.

![20_restore](/images/arp_spoofing_sec/20_restore.png)

Оставлять IP Forwarding включенным на рабочей машине небезопасно и нецелесообразно. Теперь наша система снова игнорирует пакеты, адресованные не ей.

## Как защититься

Защита от ARP Spoofing работает только в сетях без базовой безопасности. Основные способы: 
- использовать статические ARP‑записи, жёстко привязывая IP‑адрес шлюза к его MAC‑адресу;
- включить Dynamic ARP Inspection на управляемых коммутаторах, чтобы блокировать поддельные ARP‑пакеты; применять HTTPS и VPN для шифрования трафика, чтобы MITM‑атакер не видел содержимое данных;
- настроить Port Security для ограничения числа MAC‑адресов на порту;
- сегментировать сеть с помощью VLAN, чтобы ARP‑запросы не выходили за пределы своего сегмента.